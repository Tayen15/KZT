<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= guild.name %> - Prayer Times
    </title>
    <link rel="stylesheet" href="/css/output.css">
    <style>
        .switch-toggle input:checked~.switch-slider {
            background-color: #5865F2;
        }

        .switch-toggle input:checked~.switch-slider:before {
            transform: translateX(24px);
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #23272f;
            transition: .3s;
            border-radius: 28px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        .prayer-checkbox {
            width: 20px;
            height: 20px;
            accent-color: #5865F2;
            cursor: pointer;
        }
    </style>
</head>

<body class="bg-[#1a1d23] text-white">
    <div class="flex h-screen overflow-hidden">
        <!-- Dashboard Sidebar -->
        <% const currentPage='prayer' ; %>
        <%- include('../partials/dashboard-sidebar', { guild, currentPage, user, guilds }) %>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto ml-0 lg:ml-64 transition-all duration-300">
            <!-- Sticky Top Bar -->
            <div class="sticky top-0 z-10 bg-[#23272f]/95 backdrop-blur-sm border-b border-[#3a3f4b] px-8 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-white">Prayer Times</h1>
                        <p class="text-[#b9bbbe] text-sm mt-1">Configure Islamic prayer times notifications for your server</p>
                    </div>
                    <a href="/dashboard" 
                       class="text-[#b9bbbe] hover:text-[#5865F2] transition-colors duration-200 flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-[#2b2f38]">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        <span class="font-medium">Back to Servers</span>
                    </a>
                </div>
            </div>

            <!-- Content Area -->
            <div class="p-8">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Left Column: Settings Form -->
                    <div class="lg:col-span-2 space-y-6">
                        <form action="/api/guild/<%= guild.guildId %>/prayer" method="POST" class="space-y-6">
                            <!-- Enable/Disable -->
                            <div class="bg-[#2b2f38] border border-[#3a3f4b] rounded-xl p-6 hover:border-[#5865F2]/50 transition-all duration-300">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-xl font-bold mb-1">Prayer Times Notifications</h2>
                                        <p class="text-[#b9bbbe] text-sm">
                                            Aktifkan notifikasi waktu sholat otomatis
                                        </p>
                                    </div>
                                    <label class="switch-toggle relative inline-block w-14 h-7">
                                        <input type="checkbox" name="enabled" value="true" <%=prayerTimes.enabled ? 'checked' : '' %> class="opacity-0 w-0 h-0">
                                        <span class="switch-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Location Settings -->
                            <div class="bg-[#2b2f38] border border-[#3a3f4b] rounded-xl p-6 hover:border-[#5865F2]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="p-2 bg-[#5865F2]/10 rounded-lg">
                                        <svg class="w-5 h-5 text-[#5865F2]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-semibold">Location Settings</h2>
                                        <p class="text-[#b9bbbe] text-sm">Set your location for accurate prayer times</p>
                                    </div>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label for="country" class="block text-sm font-medium text-gray-400 mb-2">Country<span class="text-red-500 ml-1">*</span></label>
                                        <select id="country" name="country" required
                                            class="w-full bg-[#23272f] border border-[#3a3f4b] rounded-lg px-4 py-2.5 focus:outline-none focus:border-[#5865F2] focus:ring-2 focus:ring-[#5865F2]/20 transition-all">
                                            <option value="">Select Country...</option>
                                            <option value="Indonesia" <%= (prayerTimes.country || '') === 'Indonesia' ? 'selected' : '' %>>üáÆüá© Indonesia</option>
                                            <option value="Malaysia" <%= (prayerTimes.country || '') === 'Malaysia' ? 'selected' : '' %>>üá≤üáæ Malaysia</option>
                                            <option value="Singapore" <%= (prayerTimes.country || '') === 'Singapore' ? 'selected' : '' %>>üá∏üá¨ Singapore</option>
                                            <option value="Brunei" <%= (prayerTimes.country || '') === 'Brunei' ? 'selected' : '' %>>üáßüá≥ Brunei</option>
                                            <option value="Thailand" <%= (prayerTimes.country || '') === 'Thailand' ? 'selected' : '' %>>üáπüá≠ Thailand</option>
                                            <option value="Philippines" <%= (prayerTimes.country || '') === 'Philippines' ? 'selected' : '' %>>üáµüá≠ Philippines</option>
                                            <option value="Saudi Arabia" <%= (prayerTimes.country || '') === 'Saudi Arabia' ? 'selected' : '' %>>üá∏üá¶ Saudi Arabia</option>
                                            <option value="United Arab Emirates" <%= (prayerTimes.country || '') === 'United Arab Emirates' ? 'selected' : '' %>>üá¶üá™ United Arab Emirates</option>
                                            <option value="Turkey" <%= (prayerTimes.country || '') === 'Turkey' ? 'selected' : '' %>>üáπüá∑ Turkey</option>
                                            <option value="Egypt" <%= (prayerTimes.country || '') === 'Egypt' ? 'selected' : '' %>>üá™üá¨ Egypt</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="city" class="block text-sm font-medium text-gray-400 mb-2">City<span class="text-red-500 ml-1">*</span></label>
                                        <select id="city" name="city" required
                                            class="w-full bg-[#23272f] border border-[#3a3f4b] rounded-lg px-4 py-2.5 focus:outline-none focus:border-[#5865F2] focus:ring-2 focus:ring-[#5865F2]/20 transition-all">
                                            <option value="">Select City...</option>
                                            <!-- Indonesia -->
                                            <optgroup label="Indonesia">
                                                <option value="Jakarta" <%= (prayerTimes.city || '') === 'Jakarta' ? 'selected' : '' %>>Jakarta</option>
                                                <option value="Surabaya" <%= (prayerTimes.city || '') === 'Surabaya' ? 'selected' : '' %>>Surabaya</option>
                                                <option value="Bandung" <%= (prayerTimes.city || '') === 'Bandung' ? 'selected' : '' %>>Bandung</option>
                                                <option value="Medan" <%= (prayerTimes.city || '') === 'Medan' ? 'selected' : '' %>>Medan</option>
                                                <option value="Semarang" <%= (prayerTimes.city || '') === 'Semarang' ? 'selected' : '' %>>Semarang</option>
                                                <option value="Makassar" <%= (prayerTimes.city || '') === 'Makassar' ? 'selected' : '' %>>Makassar</option>
                                                <option value="Palembang" <%= (prayerTimes.city || '') === 'Palembang' ? 'selected' : '' %>>Palembang</option>
                                                <option value="Yogyakarta" <%= (prayerTimes.city || '') === 'Yogyakarta' ? 'selected' : '' %>>Yogyakarta</option>
                                                <option value="Denpasar" <%= (prayerTimes.city || '') === 'Denpasar' ? 'selected' : '' %>>Denpasar</option>
                                                <option value="Balikpapan" <%= (prayerTimes.city || '') === 'Balikpapan' ? 'selected' : '' %>>Balikpapan</option>
                                            </optgroup>
                                            <!-- Malaysia -->
                                            <optgroup label="Malaysia">
                                                <option value="Kuala Lumpur" <%= (prayerTimes.city || '') === 'Kuala Lumpur' ? 'selected' : '' %>>Kuala Lumpur</option>
                                                <option value="Johor Bahru" <%= (prayerTimes.city || '') === 'Johor Bahru' ? 'selected' : '' %>>Johor Bahru</option>
                                                <option value="Penang" <%= (prayerTimes.city || '') === 'Penang' ? 'selected' : '' %>>Penang</option>
                                                <option value="Shah Alam" <%= (prayerTimes.city || '') === 'Shah Alam' ? 'selected' : '' %>>Shah Alam</option>
                                            </optgroup>
                                            <!-- Other Countries -->
                                            <optgroup label="Singapore">
                                                <option value="Singapore" <%= (prayerTimes.city || '') === 'Singapore' ? 'selected' : '' %>>Singapore</option>
                                            </optgroup>
                                            <optgroup label="Brunei">
                                                <option value="Bandar Seri Begawan" <%= (prayerTimes.city || '') === 'Bandar Seri Begawan' ? 'selected' : '' %>>Bandar Seri Begawan</option>
                                            </optgroup>
                                            <optgroup label="Saudi Arabia">
                                                <option value="Mecca" <%= (prayerTimes.city || '') === 'Mecca' ? 'selected' : '' %>>Mecca</option>
                                                <option value="Medina" <%= (prayerTimes.city || '') === 'Medina' ? 'selected' : '' %>>Medina</option>
                                                <option value="Riyadh" <%= (prayerTimes.city || '') === 'Riyadh' ? 'selected' : '' %>>Riyadh</option>
                                                <option value="Jeddah" <%= (prayerTimes.city || '') === 'Jeddah' ? 'selected' : '' %>>Jeddah</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Channel Settings -->
                            <div class="bg-[#2b2f38] border border-[#3a3f4b] rounded-xl p-6 hover:border-[#5865F2]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="p-2 bg-[#5865F2]/10 rounded-lg">
                                        <svg class="w-5 h-5 text-[#5865F2]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-semibold">Notification Channel<span class="text-red-500 ml-2">*</span></h2>
                                        <p class="text-[#b9bbbe] text-sm">Choose where to send prayer notifications</p>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-400 mb-2">Select text channel</label>
                                    <select id="channelSelect" name="channelId" required
                                        class="w-full bg-[#23272f] border border-[#3a3f4b] rounded-lg px-4 py-2.5 focus:outline-none focus:border-[#5865F2] focus:ring-2 focus:ring-[#5865F2]/20 transition-all">
                                        <option value="">Loading channels...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Prayer Times Selection -->
                            <div class="bg-[#2b2f38] border border-[#3a3f4b] rounded-xl p-6 hover:border-[#5865F2]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="p-2 bg-[#5865F2]/10 rounded-lg">
                                        <svg class="w-5 h-5 text-[#5865F2]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-semibold">Prayer Times to Notify</h2>
                                        <p class="text-[#b9bbbe] text-sm">Select which prayer times to notify</p>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <label class="flex items-center gap-3 p-3 bg-[#23272f] border border-[#3a3f4b] rounded-lg hover:border-[#5865F2] transition-all cursor-pointer group">
                                        <input type="checkbox" name="notifyFajr" value="true" <%=prayerTimes.notifyFajr ? 'checked' : '' %> class="prayer-checkbox">
                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">üåÖ</span>
                                            <div>
                                                <span class="font-medium group-hover:text-[#5865F2] transition-colors">Fajr</span>
                                                <span class="text-[#b9bbbe] text-sm ml-1">(Subuh)</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 bg-[#23272f] border border-[#3a3f4b] rounded-lg hover:border-[#5865F2] transition-all cursor-pointer group">
                                        <input type="checkbox" name="notifyDhuhr" value="true" <%=prayerTimes.notifyDhuhr ? 'checked' : '' %> class="prayer-checkbox">
                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">‚òÄÔ∏è</span>
                                            <div>
                                                <span class="font-medium group-hover:text-[#5865F2] transition-colors">Dhuhr</span>
                                                <span class="text-[#b9bbbe] text-sm ml-1">(Dzuhur)</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 bg-[#23272f] border border-[#3a3f4b] rounded-lg hover:border-[#5865F2] transition-all cursor-pointer group">
                                        <input type="checkbox" name="notifyAsr" value="true" <%=prayerTimes.notifyAsr ? 'checked' : '' %> class="prayer-checkbox">
                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">üå§Ô∏è</span>
                                            <div>
                                                <span class="font-medium group-hover:text-[#5865F2] transition-colors">Asr</span>
                                                <span class="text-[#b9bbbe] text-sm ml-1">(Ashar)</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 bg-[#23272f] border border-[#3a3f4b] rounded-lg hover:border-[#5865F2] transition-all cursor-pointer group">
                                        <input type="checkbox" name="notifyMaghrib" value="true" <%=prayerTimes.notifyMaghrib ? 'checked' : '' %> class="prayer-checkbox">
                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">üåá</span>
                                            <div>
                                                <span class="font-medium group-hover:text-[#5865F2] transition-colors">Maghrib</span>
                                            </div>
                                        </div>
                                    </label>
                                    <label class="flex items-center gap-3 p-3 bg-[#23272f] border border-[#3a3f4b] rounded-lg hover:border-[#5865F2] transition-all cursor-pointer group">
                                        <input type="checkbox" name="notifyIsha" value="true" <%=prayerTimes.notifyIsha ? 'checked' : '' %> class="prayer-checkbox">
                                        <div class="flex items-center gap-2">
                                            <span class="text-2xl">üåô</span>
                                            <div>
                                                <span class="font-medium group-hover:text-[#5865F2] transition-colors">Isha</span>
                                                <span class="text-[#b9bbbe] text-sm ml-1">(Isya)</span>
                                            </div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <!-- Custom Message -->
                            <div class="bg-[#2b2f38] border border-[#3a3f4b] rounded-xl p-6 hover:border-[#5865F2]/50 transition-all duration-300">
                                <div class="flex items-center gap-3 mb-4">
                                    <div class="p-2 bg-[#5865F2]/10 rounded-lg">
                                        <svg class="w-5 h-5 text-[#5865F2]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-semibold">Custom Message</h2>
                                        <p class="text-[#b9bbbe] text-sm">Personalize your notification message</p>
                                    </div>
                                </div>
                                <div>
                                    <label for="customMessage" class="block text-sm font-medium text-gray-400 mb-2">Notification Message (Optional)</label>
                                    <textarea id="customMessage" name="customMessage" rows="3"
                                        class="w-full bg-[#23272f] border border-[#3a3f4b] rounded-lg px-4 py-2.5 focus:outline-none focus:border-[#5865F2] focus:ring-2 focus:ring-[#5865F2]/20 transition-all resize-none"
                                        placeholder="üïå Waktunya sholat {prayer}!"><%= prayerTimes.customMessage || '' %></textarea>
                                    <p class="text-[#b9bbbe] text-xs mt-2 flex items-center gap-1">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        Use <code class="px-1.5 py-0.5 bg-[#23272f] rounded text-[#5865F2]">{prayer}</code> placeholder for prayer name
                                    </p>
                                </div>
                            </div>

                            <!-- Save CTA Alert -->
                            <div id="saveCtaAlert"
                                class="fixed bottom-6 right-6 z-50 bg-[#2b2f38] text-white px-3 py-2 rounded-lg shadow-lg border border-[#3a3f4b] flex items-center gap-3 text-sm font-semibold transition-all duration-300 opacity-0 pointer-events-none">
                                <span class="flex items-center gap-2">
                                    Unsaved changes detected
                                </span>
                                <div class="flex gap-2">
                                    <button type="button" id="resetBtn"
                                        class="px-2 py-1 hover:underline transition-colors text-sm font-medium">Reset</button>
                                    <button type="submit" id="saveBtn"
                                        class="bg-[#23272f] text-[#5865F2] px-3 py-1 rounded-md text-sm font-bold hover:bg-[#5865F2] hover:text-white transition-colors">Save
                                        Settings</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Right Column: Info Panel -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Current Status -->
                        <div class="bg-[#2b2f38] border border-[#3a3f4b] rounded-xl p-6 sticky top-24">
                            <div class="flex items-center gap-3 mb-4">
                                <div class="p-2 bg-[#5865F2]/10 rounded-lg">
                                    <svg class="w-6 h-6 text-[#5865F2]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <h3 class="text-lg font-bold">Current Status</h3>
                            </div>

                            <div class="space-y-4">
                                <!-- Status Badge -->
                                <div class="flex items-center justify-between p-3 bg-[#23272f] rounded-lg">
                                    <span class="text-sm text-[#b9bbbe]">Prayer Notifications</span>
                                    <% if (prayerTimes.enabled) { %>
                                        <span class="px-2.5 py-1 bg-green-500/10 text-green-500 text-xs font-semibold rounded-full border border-green-500/30">
                                            ‚úì Enabled
                                        </span>
                                    <% } else { %>
                                        <span class="px-2.5 py-1 bg-gray-500/10 text-gray-400 text-xs font-semibold rounded-full border border-gray-500/30">
                                            ‚úó Disabled
                                        </span>
                                    <% } %>
                                </div>

                                <!-- Location Info -->
                                <% if (prayerTimes.city || prayerTimes.country) { %>
                                    <div class="p-3 bg-[#23272f] rounded-lg">
                                        <p class="text-xs text-[#b9bbbe] mb-1">Location</p>
                                        <p class="text-sm font-medium">
                                            <%= prayerTimes.city || 'Not set' %>, <%= prayerTimes.country || 'Not set' %>
                                        </p>
                                    </div>
                                <% } %>

                                <!-- Active Prayers Count -->
                                <div class="p-3 bg-[#23272f] rounded-lg">
                                    <p class="text-xs text-[#b9bbbe] mb-1">Active Prayers</p>
                                    <p class="text-2xl font-bold text-[#5865F2]">
                                        <%= [prayerTimes.notifyFajr, prayerTimes.notifyDhuhr, prayerTimes.notifyAsr, prayerTimes.notifyMaghrib, prayerTimes.notifyIsha].filter(Boolean).length %>/5
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Channel data from server
        const channelsData = JSON.parse('<%- JSON.stringify(channels) %>');
        
        // Populate channels dropdown
        function loadChannels() {
            const select = document.getElementById('channelSelect');
            if (!select) return;

            select.innerHTML = '<option value="">Select a text channel...</option>';

            if (!channelsData || channelsData.length === 0) {
                select.innerHTML += '<option value="" disabled>No text channels available</option>';
                return;
            }

            channelsData.forEach(ch => {
                const opt = document.createElement('option');
                opt.value = ch.id;
                opt.textContent = `# ${ch.name}`;
                if ('<%= prayerTimes.channelId || "" %>' === ch.id) {
                    opt.selected = true;
                }
                select.appendChild(opt);
            });
        }

        // Save CTA logic
        document.addEventListener('DOMContentLoaded', function() {
            loadChannels();

            const form = document.querySelector('form');
            const saveCta = document.getElementById('saveCtaAlert');
            const saveBtn = document.getElementById('saveBtn');
            const resetBtn = document.getElementById('resetBtn');
            let initialFormState = form ? new FormData(form) : null;

            function formChanged() {
                if (!form || !initialFormState) return false;
                const current = new FormData(form);
                for (let [key, value] of initialFormState.entries()) {
                    if (current.get(key) !== value) return true;
                }
                for (let [key, value] of current.entries()) {
                    if (initialFormState.get(key) !== value) return true;
                }
                return false;
            }

            function showSaveCta(show) {
                if (saveCta) {
                    if (show) {
                        saveCta.classList.remove('opacity-0', 'pointer-events-none');
                        saveCta.classList.add('opacity-100');
                    } else {
                        saveCta.classList.add('opacity-0', 'pointer-events-none');
                        saveCta.classList.remove('opacity-100');
                    }
                }
            }

            if (form) {
                form.addEventListener('input', () => {
                    showSaveCta(formChanged());
                });
                form.addEventListener('change', () => {
                    showSaveCta(formChanged());
                });
            }

            // Save button logic
            if (saveBtn) {
                saveBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (!form) return;

                    const formData = new FormData(form);
                    const urlParams = new URLSearchParams();

                    for (let [key, value] of formData.entries()) {
                        urlParams.append(key, value);
                    }

                    fetch(form.action, {
                        method: 'POST',
                        body: urlParams,
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                            'Accept': 'application/json'
                        }
                    }).then(res => res.json()).then(data => {
                        if (data.success) {
                            showSaveCta(false);
                            initialFormState = new FormData(form);
                            saveCta.classList.add('bg-[#57F287]');
                            saveCta.classList.remove('bg-[#2b2f38]');
                            saveBtn.textContent = '‚úì Saved!';
                            setTimeout(() => {
                                saveCta.classList.remove('bg-[#57F287]');
                                saveCta.classList.add('bg-[#2b2f38]');
                                saveBtn.textContent = 'Save Settings';
                            }, 2000);
                        } else {
                            saveCta.classList.add('bg-[#ED4245]');
                            saveCta.classList.remove('bg-[#2b2f38]');
                            saveBtn.textContent = '‚úó Error!';
                            setTimeout(() => {
                                saveCta.classList.remove('bg-[#ED4245]');
                                saveCta.classList.add('bg-[#2b2f38]');
                                saveBtn.textContent = 'Save Settings';
                            }, 2000);
                        }
                    }).catch(err => {
                        console.error('Save error:', err);
                        saveCta.classList.add('bg-[#ED4245]');
                        saveCta.classList.remove('bg-[#2b2f38]');
                        saveBtn.textContent = '‚úó Error!';
                        setTimeout(() => {
                            saveCta.classList.remove('bg-[#ED4245]');
                            saveCta.classList.add('bg-[#2b2f38]');
                            saveBtn.textContent = 'Save Settings';
                        }, 2000);
                    });
                });
            }

            // Reset button logic
            if (resetBtn && form) {
                resetBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    form.reset();
                    loadChannels();
                    showSaveCta(formChanged());
                });
            }
        });
    </script>
</body>

</html>